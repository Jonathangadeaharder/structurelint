# @structurelint:no-test Directive

## Overview

The `@structurelint:no-test` directive allows you to declare that a source file doesn't need a dedicated test file, directly in the code itself. This makes your codebase self-documenting and eliminates the need for configuration file exemptions.

## Benefits

1. **Self-Documenting Code**: The reason for not having tests is visible in the source file itself
2. **Consistency Validation**: Warns if a file claims "no test needed" but actually has a test file
3. **Cleaner Configuration**: Reduces the need for long exemption lists in `.structurelint.yml`
4. **Better Code Review**: Reviewers can see the justification for missing tests

## Syntax

```go
// @structurelint:no-test <reason>
package mypackage
```

### Supported Comment Styles

- **Go**: `// @structurelint:no-test <reason>`
- **Python**: `# @structurelint:no-test <reason>`
- **TypeScript/JavaScript**: `// @structurelint:no-test <reason>`

The directive must be placed in the first 50 lines of the file (typically in the package/module comment).

## Valid Reasons

When using `@structurelint:no-test`, provide a clear reason. Common valid reasons include:

### Interface Definitions
```go
// Package rules defines the linting rule interface and implementations.
//
// @structurelint:no-test Interface definitions and types only, tested through rule implementations
package rules
```

### Integration Test Coverage
```go
// Package rules provides rule implementations for structurelint.
//
// @structurelint:no-test Simple rule implementation tested via rules_test.go integration test
package rules
```

### Simple Utilities
```go
// Package parser provides functionality for parsing source code exports.
//
// @structurelint:no-test Simple parsing utilities tested via integration tests
package parser
```

### Work in Progress
```go
// Package init provides auto-configuration functionality for structurelint.
//
// @structurelint:no-test New feature with complex heuristics, tests TBD in next iteration
package init
```

### Manual/E2E Testing Only
```go
// Package init provides auto-configuration functionality for structurelint.
//
// @structurelint:no-test Configuration generation logic tested manually and via end-to-end testing
package init
```

### Generated Code
```go
// Code generated by protoc-gen-go. DO NOT EDIT.
//
// @structurelint:no-test Generated code, tested via integration with generator
package pb
```

## Consistency Validation

structurelint validates consistency between the directive and actual test files:

### ❌ Inconsistent: Has directive + has test file
```go
// @structurelint:no-test Interface definition only
package rules

// But rules_test.go exists!
```

**Result**: Violation warning
```
internal/rules/rule.go: declares @structurelint:no-test (Interface definition only)
but test file 'rule_test.go' exists - remove directive or test file
```

### ✅ Consistent: Has directive + no test file
```go
// @structurelint:no-test Interface definition only
package rules

// No test file exists - this is correct
```

**Result**: No violation

### ✅ Consistent: No directive + has test file
```go
// Package calculator provides arithmetic operations
package calculator

// calculator_test.go exists - this is correct
```

**Result**: No violation

### ❌ Missing: No directive + no test file
```go
// Package calculator provides arithmetic operations
package calculator

// No test file and no directive!
```

**Result**: Violation with helpful message
```
internal/calculator/math.go: missing adjacent test file 'math_test.go'
(or add @structurelint:no-test directive with reason)
```

## Migration from Config Exemptions

### Before: Configuration-based exemptions

```yaml
rules:
  test-adjacency:
    pattern: "adjacent"
    file-patterns:
      - "**/*.go"
    exemptions:
      - "internal/rules/rule.go"            # Exempt interface definition
      - "internal/rules/max_depth.go"       # Tested via rules_test.go
      - "internal/rules/max_files.go"       # Tested via rules_test.go
      - "internal/parser/exports.go"        # Simple parser
      # ... 20 more lines ...
```

### After: Directive-based exemptions

```yaml
rules:
  test-adjacency:
    pattern: "adjacent"
    file-patterns:
      - "**/*.go"
    exemptions:
      - "cmd/**/*.go"        # Entry points
      - "**/*_gen.go"        # Generated files
```

The individual file exemptions are now declared in the source files themselves with the `@structurelint:no-test` directive.

## Best Practices

### ✅ DO

1. **Provide clear reasons**: Explain *why* the file doesn't need tests
   ```go
   // @structurelint:no-test Interface definition only, tested through implementations
   ```

2. **Use for legitimate cases**:
   - Interface definitions
   - Simple type declarations
   - Generated code
   - Code tested via integration tests

3. **Review periodically**: Revisit files with this directive during refactoring
   ```go
   // @structurelint:no-test New feature, tests TBD in v2.0
   ```

4. **Remove when adding tests**: If you later add tests, remove the directive

### ❌ DON'T

1. **Don't use to avoid writing tests**:
   ```go
   // @structurelint:no-test Too complex to test
   // ❌ BAD - This is not a valid reason!
   ```

2. **Don't leave vague reasons**:
   ```go
   // @structurelint:no-test Not needed
   // ❌ BAD - Why is it not needed?
   ```

3. **Don't leave directives when tests exist**: structurelint will catch this
   ```go
   // @structurelint:no-test Interface only
   // But you have interface_test.go!
   // ❌ Will trigger violation
   ```

## Language-Specific Examples

### Go
```go
// Package models defines data structures.
//
// @structurelint:no-test Simple structs with no logic, validated via integration tests
package models

type User struct {
    ID   int
    Name string
}
```

### Python
```python
"""Configuration module for application settings."""

# @structurelint:no-test Configuration constants only, no testable logic

DATABASE_URL = "postgresql://localhost/mydb"
API_KEY = "secret"
```

### TypeScript
```typescript
// Re-export module for convenient imports
//
// @structurelint:no-test Simple re-export, tested via consuming code

export * from './components';
export * from './utils';
export * from './types';
```

## FAQ

### Q: Can I use this directive to skip all test requirements?
**A:** No! This directive is for legitimate cases where tests don't make sense. The linter will warn if you have a test file but claim you don't need one.

### Q: What if my reason changes over time?
**A:** Update the directive or add tests and remove the directive. Keep it current!

### Q: Can I use multiple directives in one file?
**A:** Only one directive per file is recognized. The linter will use the first occurrence.

### Q: What if I don't provide a reason?
**A:** The linter will accept it but will report "no reason provided". Always include a reason for clarity.

### Q: Does this work with the "separate" test pattern?
**A:** Yes! The directive works with both "adjacent" and "separate" test patterns.

### Q: Can I use this in configuration exemptions too?
**A:** You can, but the point of this directive is to move exemptions from config to code. Use pattern-based exemptions (like `cmd/**/*.go`) in config, and file-specific exemptions as directives.

## See Also

- [Test Validation Guide](TEST_VALIDATION.md)
- [Configuration Reference](../README.md#configuration)
- [Contributing Guidelines](../CONTRIBUTING.md)
